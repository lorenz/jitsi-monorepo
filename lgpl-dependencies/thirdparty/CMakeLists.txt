include(ExternalProject)

set(external_download_dir ${CMAKE_SOURCE_DIR}/thirdparty)

if(WIN32)
    set(DEFAULT_USE_SYSTEM_FFMPEG OFF)
    set(DEFAULT_USE_SYSTEM_LAME OFF)
    set(DEFAULT_USE_SYSTEM_OPENH264 ON)
elseif(APPLE)
    set(DEFAULT_USE_SYSTEM_FFMPEG OFF)
    set(DEFAULT_USE_SYSTEM_LAME OFF)
    set(DEFAULT_USE_SYSTEM_OPENH264 OFF)
else()
    set(DEFAULT_USE_SYSTEM_FFMPEG ON)
    set(DEFAULT_USE_SYSTEM_LAME ON)
    set(DEFAULT_USE_SYSTEM_OPENH264 OFF)
endif()

option(USE_SYSTEM_FFMPEG "Use the system provided FFmpeg?" ${DEFAULT_USE_SYSTEM_FFMPEG})
option(USE_SYSTEM_LAME "Use the system Lame? Only relevant if not using the system FFmpeg" ${DEFAULT_USE_SYSTEM_LAME})
option(USE_SYSTEM_OPENH264 "Use the system OpenH264? Only relevant if not using the system FFmpeg" ${DEFAULT_USE_SYSTEM_OPENH264})

if(USE_SYSTEM_FFMPEG)
    pkg_check_modules(LIBAVUTIL libavutil>=54 REQUIRED)
    pkg_check_modules(LIBAVCODEC libavcodec>=56 REQUIRED)
    pkg_check_modules(LIBAVFORMAT libavformat>=56 REQUIRED)
    pkg_check_modules(LIBAVFILTER libavfilter>=5 REQUIRED)
    pkg_check_modules(LIBSWSCALE libswscale>=3 REQUIRED)
else()
    if(USE_SYSTEM_OPENH264)
        pkg_check_modules(LIBOPENH264 openh264>=1.7.0 REQUIRED)
    else()
        include(External_openh264)
        set(LIBOPENH264_INCLUDE_DIRS ${LIBOPENH264_INCLUDE_DIRS} PARENT_SCOPE)
        set(LIBOPENH264_LIBRARY_DIRS ${LIBOPENH264_LIBRARY_DIRS} PARENT_SCOPE)
    endif()

    if(USE_SYSTEM_LAME)
        find_package(LIBMP3LAME REQUIRED)
    else()
        include(External_lame)
        set(libmp3lame_INCLUDE_DIRS ${libmp3lame_INCLUDE_DIRS} PARENT_SCOPE)
        set(libmp3lame_LIBRARY_DIRS ${libmp3lame_LIBRARY_DIRS} PARENT_SCOPE)
    endif()

    include(External_ffmpeg)
    set(FFMPEG_INCLUDE_DIRS ${FFMPEG_INCLUDE_DIRS} PARENT_SCOPE)
    set(FFMPEG_LIBRARY_DIRS ${FFMPEG_LIBRARY_DIRS} PARENT_SCOPE)
    set(FFMPEG_OH264_INCLUDE_DIRS ${FFMPEG_OH264_INCLUDE_DIRS} PARENT_SCOPE)
    set(FFMPEG_OH264_LIBRARY_DIRS ${FFMPEG_OH264_LIBRARY_DIRS} PARENT_SCOPE)
endif()
